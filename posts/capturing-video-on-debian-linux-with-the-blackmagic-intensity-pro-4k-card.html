---
author: admin
categories:
- Technical
date: 2019-08-09 00:49:39-07:00
markup: html
source: wordpress
tags:
- blackmagic
- linux
- streaming
title: Capturing video on Debian Linux with the Blackmagic Intensity Pro 4K card
updated: 2020-05-17 12:55:33-07:00
wordpress_id: 462
wordpress_slug: capturing-video-on-debian-linux-with-the-blackmagic-intensity-pro-4k-card
---
<!-- blogpost -->
<article class="post-462 post type-post status-publish format-standard hentry category-technical tag-blackmagic tag-linux tag-streaming" id="post-462">
<h1 class="entry-title">Capturing video on Debian Linux with the Blackmagic Intensity Pro 4K card</h1>
<div class="entry-meta">
<span class="author vcard"> By  <a class="url fn n" href="https://blog.za3k.com/author/admin/" rel="author" title="View all posts by admin">admin</a> <span class="bl_sep">|</span></span> <time class="onDate date published" datetime="2019-08-09T00:49:39-07:00"> <a href="https://blog.za3k.com/capturing-video-on-debian-linux-with-the-blackmagic-intensity-pro-4k-card/" rel="bookmark" title="12:49 am"><span class="entry-date">August 9, 2019</span> <span class="entry-time"> - 12:49 am</span></a> </time><span class="bl_sep">|</span><time class="updated" datetime="2020-05-17T12:55:33-07:00">May 17, 2020</time> <span class="bl_categ"> <a href="https://blog.za3k.com/category/technical/" rel="tag">Technical</a> </span> </div><!-- .entry-meta -->
<div class="entry-content">
<p>Most of this should apply for any linux system, other than the driver install step. Also, I believe most of it applies to DeckLink and Intensity cards as well.</p>
<p>My main source is <a href="https://gist.github.com/afriza/879fed4ede539a5a6501e0f046f71463">https://gist.github.com/afriza/879fed4ede539a5a6501e0f046f71463</a>. I’ve re-written for clarity and Debian.</p>
<ol><li>Set up hardware. On the Intensity Pro 4K, I see a black screen on my TV when things are set up correctly (a clear rectangle, not just nothing).</li><li>From the Blackmagic site, download “Desktop Video SDK” version 10.11.4 (not the latest). Get the matching “Desktop Video” software for Linux.</li><li>Install the drivers. In my case, these were in <code>desktopvideo_11.3a7_amd64.deb</code>.<br/>After driver install, <code>lsmod | grep blackmagic</code> should show a driver loaded on debian.<br/>You can check that the PCI card is recognized with <code>lspci | grep Blackmagic</code> (I think this requires the driver but didn’t check)</li><li>Update the firmware (optional). <code>sudo BlackmagicFirmwareUpdater status</code> will check for updates available. There were none for me.</li><li>Extract the SDK. Move it somewhere easier to type. The relevant folder is <code>Blackmagic DeckLink SDK 10.11.4/Linux/includes</code>. Let’s assume you move that to <code>~/BM_SDK</code></li><li>Build ffmpeg from source. I’m here copying from my source heavily.<ol><li>Get the latest ffmpeg source and extract it. Don’t match the debian version–it’s too old to work.<br/><code>wget https://ffmpeg.org/releases/ffmpeg-4.2.tar.bz2 &amp;&amp; tar xf ffmpeg-*.tar.bz2 &amp;&amp; cd ffmpeg-*</code></li><li>Install build deps.<br/><code>sudo apt-get install nasm yasm libx264-dev libx265-dev libnuma-dev libvpx-dev libfdk-aac-dev libmp3lame-dev libopus-dev libvorbis-dev libass-dev</code></li><li>Build.<br/><code>PKG_CONFIG_PATH="$HOME/ffmpeg_build/lib/pkgconfig" ./configure --prefix="$HOME/ffmpeg_build" --pkg-config-flags="--static" --extra-cflags="-I$HOME/ffmpeg_build/include -I$HOME/ffmpeg_sources/BMD_SDK/include" --extra-ldflags="-L$HOME/ffmpeg_build/lib" --extra-libs="-lpthread -lm" --enable-gpl --enable-libass --enable-libfdk-aac --enable-libfreetype --enable-libmp3lame --enable-libopus --enable-libvorbis --enable-libvpx --enable-libx264 --enable-libx265 --enable-nonfree --enable-decklink</code><br/><br/><code>make -j $(<code>nproc)</code></code><br/><br/><code>sudo cp ffmpeg ffprobe /usr/local/bin/</code></li></ol></li><li>Use ffmpeg. <br/><code>ffmpeg -f decklink -list_devices 1 -i dummy</code> should show your device now. Note the name for below.<br/><br/><code>ffmpeg -f decklink -list_formats 1 -i 'Intensity Pro 4K'</code> shows supported formats. Here’s what I see for the Intensity Pro 4K:</li></ol>
<pre class="wp-block-code"><code>[decklink @ 0x561bd9881800] Supported formats for 'Intensity Pro 4K':
        format_code     description
        ntsc            720x486 at 30000/1001 fps (interlaced, lower field first)
        pal             720x576 at 25000/1000 fps (interlaced, upper field first)
        23ps            1920x1080 at 24000/1001 fps
        24ps            1920x1080 at 24000/1000 fps
        Hp25            1920x1080 at 25000/1000 fps
        Hp29            1920x1080 at 30000/1001 fps
        Hp30            1920x1080 at 30000/1000 fps
        Hp50            1920x1080 at 50000/1000 fps
        Hp59            1920x1080 at 60000/1001 fps
        Hp60            1920x1080 at 60000/1000 fps
        Hi50            1920x1080 at 25000/1000 fps (interlaced, upper field first)
        Hi59            1920x1080 at 30000/1001 fps (interlaced, upper field first)
        Hi60            1920x1080 at 30000/1000 fps (interlaced, upper field first)
        hp50            1280x720 at 50000/1000 fps
        hp59            1280x720 at 60000/1001 fps
        hp60            1280x720 at 60000/1000 fps
        4k23            3840x2160 at 24000/1001 fps
        4k24            3840x2160 at 24000/1000 fps
        4k25            3840x2160 at 25000/1000 fps
        4k29            3840x2160 at 30000/1001 fps
        4k30            3840x2160 at 30000/1000 fps
</code></pre>
<p>Capture some video: <code>ffmpeg -raw_format argb -format_code Hp60 -f decklink -i 'Intensity Pro 4K' test.avi</code> </p>
<p>The format (<code>raw_format</code> and <code>format_code</code>) will vary based on your input settings. In particular, note that<code>-raw_format uyvy422</code> is the default, which I found did not match my computer output. I was able to switch either the command line or the computer output settings to fix it.</p>
<p>Troubleshooting</p>
<ul><li><strong>I’m not running any capture, but passthrough isn’t working.</strong> That’s how the Intensity Pro 4K works. Passthrough is not always-on. I’d recommend a splitter if you want this for streaming.</li><li><strong>ffmpeg won’t compile. </strong>Your DeckLink SDK may be too new. Get 10.11.4 instead.</li><li><strong>I can see a list of formats, but I can’t select one using -format_code. ffmpeg doesn’t recognize the option.</strong> Your ffmpeg is too old. Download a newer source.</li><li><strong>When I look at the video, I see colored bars. The HDMI output turns on during recording. </strong>The Intensity Pro 4K outputs this when the resolution, hertz, or color format does not match the input. This also happens if your SDK and driver versions are mismatched.</li></ul>
<p>Sources:</p>
<ul><li><a href="https://gist.github.com/afriza/879fed4ede539a5a6501e0f046f71463">https://gist.github.com/afriza/879fed4ede539a5a6501e0f046f71463</a></li><li><a href="https://ffmpeg.org/ffmpeg-devices.html#decklink">https://ffmpeg.org/ffmpeg-devices.html#decklink</a></li></ul>
<p></p>
</div><!-- .entry-content -->
<div class="entry-utility">
<span class="bl_posted">Tagged <a href="https://blog.za3k.com/tag/blackmagic/" rel="tag">blackmagic</a>, <a href="https://blog.za3k.com/tag/linux/" rel="tag">linux</a>, <a href="https://blog.za3k.com/tag/streaming/" rel="tag">streaming</a>.</span><span class="bl_bookmark"> Bookmark the  <a href="https://blog.za3k.com/capturing-video-on-debian-linux-with-the-blackmagic-intensity-pro-4k-card/" rel="bookmark" title="Permalink to Capturing video on Debian Linux with the Blackmagic Intensity Pro 4K card"> permalink</a>.</span> </div><!-- .entry-utility -->
</article>

<!-- comments -->
