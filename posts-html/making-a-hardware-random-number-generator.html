---
author: admin
categories:
- Technical
date: 2021-06-06 17:23:06-07:00
markup: html
source: wordpress
tags:
- hardware
- linux
- randomness
title: Making a hardware random number generator
updated: 2021-06-06 17:28:29-07:00
wordpress_id: 598
wordpress_slug: making-a-hardware-random-number-generator
---
<!-- blogpost -->
<div class="entry-content">
<p>If you want a really good source of random numbers, you should get a hardware generator. But there’s not a lot of great options out there, and most people looking into this get (understandably) paranoid about backdoors. But, there’s a nice trick: if you combine multiple random sources together with <a href="https://github.com/za3k/short-programs#xor">xor</a>, it doesn’t matter if one is backdoored, as long as they aren’t all backdoored. There are some exceptions–if the backdoor is actively looking at the output, it can still break your system. But as long as you’re just generating some random pads, instead of making a kernel entropy pool, you’re fine with this trick.</p>
<p>So! We just need a bunch of sources of randomness. Here’s the options I’ve tried:</p>
<ul><li>/dev/urandom (40,000KB/s) – this is nearly a pseudo-random number generator, so it’s not that good. But it’s good to throw in just in case. [<a href="https://stackoverflow.com/questions/23712581/differences-between-random-and-urandom">Learn</a> about /dev/random vs /dev/urandom if you haven’t. Then <a href="https://www.2uo.de/myths-about-urandom/">unlearn</a> it again.]</li><li><a href="https://github.com/za3k/short-programs#prng">random-stream</a> (1,000 KB/s), an implementation of the merenne twister pseudo-random-number generator. A worse version of /dev/urandom, use that unless you don’t trust the Linux kernel for some reason.</li><li><a href="https://github.com/waywardgeek/infnoise">infnoise</a> (20-23 KB/s), a USB hardware random number generator. Optionally whitens using <a href="https://en.wikipedia.org/wiki/SHA-3">keccak</a>. Mine is unfortunately broken (probably?) and outputs “USB read error” after a while</li><li><a href="https://onerng.info/">OneRNG</a> (55 KiB/s), a USB hardware random number generator. I use a <a href="https://gist.github.com/za3k/64faa4aa0a9ecb338a8af8b0569fccb6">custom script</a> which outputs raw data instead of the provided scripts (although they look totally innocuous, do recommend</li><li>/dev/hwrng (123 KB/s), which accesses the hardware random number generator built into the raspberry pi. this device is provided by the <a href="https://packages.debian.org/buster/rng-tools-debian">raspbian</a> package <a href="https://github.com/nhorman/rng-tools">rng-tools</a>. I learned about this option <a href="https://scruss.com/blog/2013/06/07/well-that-was-unexpected-the-raspberry-pis-hardware-random-number-generator/">here</a></li><li><a href="https://github.com/jtulak/RdRand">rdrand-gen</a> (5,800 KB/s), a command-line tool to output random numbers from the Intel hardware generator instruction, <a href="https://en.wikipedia.org/wiki/RDRAND">RDRAND</a>.</li></ul>
<p>At the end, you can use my <a href="https://github.com/za3k/short-programs#xor">xor</a> program to combine the streams/files. Make sure to use limit the output size if using files–by default it does not stop outputting data until EVERY file ends. The speed of the combined stream is at most going to be the slowest component (plus a little slowdown to xor everything). Here’s my final command line:</p>
<pre class="wp-block-code"><code>#!/bin/bash
# Fill up the folder with 1 GB one-time pads. Requires 'rng-tools' and a raspberry pi. Run as sudo to access /dev/hwrng.
while true; do
  sh onerng.sh | dd bs=1K count=1000000 of=tmp-onerng.pad 2&gt;/dev/null
  infnoise --raw | dd bs=1K count=1000000 of=tmp-infnoise.pad 2&gt;/dev/null
  xor tmp-onerng.pad tmp-infnoise.pad /dev/urandom /dev/hwrng | dd bs=1K count=1000000 of=/home/pi/pads/1GB-`\date +%Y-%m-%d-%H%M%S`.pad 2&gt;/dev/null;
done</code></pre>
<p>Great, now you have a good one-time-pad and can join <a href="https://za3k.com/ok-mixnet.md">ok-mixnet</a> 🙂</p>
<p>P.S. If you <em>really</em> know what you’re doing and like shooting yourself in the foot, you could try combining and whitening entropy sources with a randomness sponge like keccak instead.</p>
</div>

<!-- comments -->
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="li-comment-11135">
<div id="comment-11135">
<div class="comment-author vcard">
<img alt="" class="avatar avatar-40 photo" decoding="async" height="40" src="https://secure.gravatar.com/avatar/477bf018c52601e86d3a8aa07c6f9392?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/477bf018c52601e86d3a8aa07c6f9392?s=80&amp;d=mm&amp;r=g 2x" width="40"/><cite class="fn">jiacheng hao</cite> <span class="says">says:</span>
</div><!-- .comment-author .vcard -->
<div class="comment-meta commentmetadata"><a href="https://blog.za3k.com/making-a-hardware-random-number-generator/#comment-11135">
			March 3, 2024 at 9:04 pm</a> </div><!-- .comment-meta .commentmetadata -->
<div class="comment-body">
<p>Hello, I think you are truely right about the TRNG. I am a researcher who specializes in designing TRNG. And now I have a TRNG chip with PCB support USB2.0. And the speed can be up to 30Mbps. It can pass NIST 800-22 and 800-90B. Are you interested in that? Looking forward to your reply!!</p>
</div>
<div class="reply">
<a aria-label="Reply to jiacheng hao" class="comment-reply-link" data-belowelement="comment-11135" data-commentid="11135" data-postid="598" data-replyto="Reply to jiacheng hao" data-respondelement="respond" href="https://blog.za3k.com/making-a-hardware-random-number-generator/?replytocom=11135#respond" rel="nofollow">Reply</a> </div><!-- .reply -->
</div><!-- #comment-##  -->
</li><!-- #comment-## -->
<li class="comment byuser comment-author-admin bypostauthor odd alt thread-odd thread-alt depth-1" id="li-comment-11136">
<div id="comment-11136">
<div class="comment-author vcard">
<img alt="" class="avatar avatar-40 photo" decoding="async" height="40" src="https://secure.gravatar.com/avatar/09485be3ee1e86da6e39412f5c1b2a48?s=40&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/09485be3ee1e86da6e39412f5c1b2a48?s=80&amp;d=mm&amp;r=g 2x" width="40"/><cite class="fn">admin</cite> <span class="says">says:</span>
</div><!-- .comment-author .vcard -->
<div class="comment-meta commentmetadata"><a href="https://blog.za3k.com/making-a-hardware-random-number-generator/#comment-11136">
			March 3, 2024 at 11:36 pm</a> </div><!-- .comment-meta .commentmetadata -->
<div class="comment-body">
<p>Interested in what way?</p>
<p>Is your TRNG open-source?</p>
<p>Where do you research?</p>
</div>
<div class="reply">
<a aria-label="Reply to admin" class="comment-reply-link" data-belowelement="comment-11136" data-commentid="11136" data-postid="598" data-replyto="Reply to admin" data-respondelement="respond" href="https://blog.za3k.com/making-a-hardware-random-number-generator/?replytocom=11136#respond" rel="nofollow">Reply</a> </div><!-- .reply -->
</div><!-- #comment-##  -->
</li><!-- #comment-## -->
</ol>